<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crypto Payment Address Generator</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        select, input, button { margin: 10px 0; padding: 5px; }
        #result { margin-top: 20px; }
		.spinner {width: 48px;height: 48px;margin: 0 auto;background: transparent url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI0OCIgaGVpZ2h0PSI0OCIgdmlld0JveD0iMCAwIDQ4IDQ4IiBzdHJva2U9IiMwMDAwMDAiIHN0cm9rZS13aWR0aD0iNCIgZmlsbD0ibm9uZSIgc3Ryb2tlLW9wYWNpdHk9IjAuMyI+CiAgPGNpcmNsZSBjeD0iMjQiIGN5PSIyNCIgcj0iMjAiLz4KICA8cGF0aCBkPSJNNDQgMjRhMjAgMjAgMCAwIDEtMjAgMjAiPgogICAgPGFuaW1hdGVUcmFuc2Zvcm0gYXR0cmlidXRlTmFtZT0idHJhbnNmb3JtIiB0eXBlPSJyb3RhdGUiIGZyb209IjAgMjQgMjQiIHRvPSIzNjAgMjQgMjQiIGR1cj0iMXMiIHJlcGVhdENvdW50PSJpbmRlZmluaXRlIi8+CiAgPC9wYXRoPgo8L3N2Zz4=') center center no-repeat;background-size: 40px 40px;}
    </style>
</head>
<body>
    <h1>Crypto Payment Address Generator</h1>
    <form id="paymentForm">
        <label for="amount">Amount:</label>
        <input type="number" id="amount" required min="0.01" step="0.01">

        <label for="fiatCurrency">Fiat Currency:</label>
        <select id="fiatCurrency"></select>

        <label for="cryptoTicker">Crypto Ticker:</label>
        <select id="cryptoTicker"></select>

        <label for="wallet">Payout Wallet Address:</label>
        <input type="text" id="merchantWallet">

        <button type="submit">Generate Payment Address</button>
    </form>
<div id="loading-spinner" style="display:none; text-align:center; margin-top:10px;">
    <div class="spinner"></div>
</div>

    <div id="result"></div>
    <div id="qrcode"></div>

    <script>
    const fiatCurrencies = ['USD', 'EUR', 'GBP', 'CAD', 'JPY', 'AED', 'MYR', 'IDR', 'THB', 'CHF', 'SGD', 'RUB', 'ZAR', 'TRY', 'LKR', 'RON', 'BGN', 'HUF', 'CZK', 'PHP', 'PLN', 'UGX', 'MXN', 'INR', 'HKD', 'CNY', 'BRL', 'DKK', 'TWD', 'AUD', 'NGN', 'SEK', 'NOK', 'UAH'];

    const cryptoTickers = ['btc', 'bch', 'ltc', 'doge', 'bep20/1inch', 'bep20/ada', 'bep20/bnb', 'bep20/btcb', 'bep20/cake', 'bep20/dai', 'bep20/doge', 'bep20/eth', 'bep20/ltc', 'bep20/phpt', 'bep20/shib', 'bep20/usd1', 'bep20/usdc', 'bep20/usdt', 'bep20/xrp', 'erc20/1inch', 'erc20/arb', 'erc20/bnb', 'erc20/cbbtc', 'erc20/dai', 'erc20/link', 'erc20/ondo', 'erc20/pepe', 'erc20/pol', 'erc20/pyusd', 'erc20/shib', 'erc20/usd1', 'erc20/usdc', 'erc20/usdt', 'erc20/wxrp', 'arbitrum/arb', 'arbitrum/dai', 'arbitrum/eth', 'arbitrum/link', 'arbitrum/pepe', 'arbitrum/pyusd', 'arbitrum/usdc', 'arbitrum/usdc.e', 'arbitrum/usdt0', 'polygon/avax', 'polygon/pol', 'polygon/usdc', 'polygon/usdc.e', 'polygon/usdt', 'polygon/weth', 'avax-c/avax', 'avax-c/usdc', 'avax-c/usdc.e', 'avax-c/usdt', 'avax-c/wavax', 'avax-c/weth.e', 'base/cbbtc', 'base/dai', 'base/eth', 'base/usdc', 'base/usdt', 'optimism/dai', 'optimism/eth', 'optimism/link', 'optimism/op', 'optimism/usdc', 'optimism/usdc.e', 'optimism/usdt', 'optimism/usdt0', 'eth', 'linea/eth', 'linea/usdc', 'linea/usdt', 'monad/mon', 'monad/usdc', 'monad/usdt0', 'sol/cbbtc', 'sol/eurc', 'sol/hnt', 'sol/pyusd', 'sol/sol', 'sol/trump', 'sol/usdc', 'sol/usdt', 'sol/wbtc', 'sol/weth', 'trc20/btc', 'trc20/inrt', 'trc20/tusd', 'trc20/usdd', 'trc20/usdt', 'trx'];

    const fiatSelect = document.getElementById('fiatCurrency');
    const cryptoSelect = document.getElementById('cryptoTicker');

    fiatCurrencies.forEach(currency => {
        const option = document.createElement('option');
        option.value = currency;
        option.textContent = currency;
        fiatSelect.appendChild(option);
    });

    cryptoTickers.forEach(ticker => {
        const option = document.createElement('option');
        option.value = ticker;
        option.textContent = ticker;
        cryptoSelect.appendChild(option);
    });

    document.getElementById('paymentForm').addEventListener('submit', async function(e) {
        e.preventDefault();
	const spinner = document.getElementById('loading-spinner');
    const resultDiv = document.getElementById('result');
    const qrDiv = document.getElementById('qrcode');

    // Clear previous results
    resultDiv.innerHTML = '';
    qrDiv.innerHTML = '';

    // Show spinner
    spinner.style.display = 'block';
	
        const amount = document.getElementById('amount').value;
        const fiatCurrency = document.getElementById('fiatCurrency').value;
        const cryptoTicker = document.getElementById('cryptoTicker').value;
        const merchantWallet = document.getElementById('merchantWallet').value;
        const callbackUrl = `https://paygate.to/payment-link/invoice.php?payment=${Date.now()}_${Math.floor(Math.random() * 9000000) + 1000000}`;

        try {
            // Convert fiat to crypto
            const convertResponse = await fetch(`https://api.paygate.to/crypto/${cryptoTicker}/convert.php?from=${fiatCurrency}&value=${amount}`);
            const convertData = await convertResponse.json();

            if (convertData.status !== 'success') {
			spinner.style.display = 'none';
                throw new Error('Conversion failed');
            }

            const cryptoAmount = convertData.value_coin;
			
		    const infoResponse = await fetch(`https://api.paygate.to/crypto/${cryptoTicker}/info.php`);
            const infoData = await infoResponse.json();
			if (!infoData || !infoData.minimum) {
            spinner.style.display = 'none';
            throw new Error('Failed to retrieve coin info.');
            }
			
			const minimumCrypto = parseFloat(infoData.minimum);
			
			if (cryptoAmount < minimumCrypto) {
            spinner.style.display = 'none';
            throw new Error(`Minimum amount for ${cryptoTicker.toUpperCase()} is ${minimumCrypto} ${cryptoTicker}.`);
            }

            // Generate wallet address
            const walletResponse = await fetch(`https://api.paygate.to/crypto/${cryptoTicker}/wallet.php?address=${merchantWallet}&callback=${encodeURIComponent(callbackUrl)}`);
         // Check HTTP status
        if (!walletResponse.ok) {
		spinner.style.display = 'none';
            throw new Error(`Wallet generation failed. Insert a valid wallet`);
        }
			const walletData = await walletResponse.json();

            if (!walletData.address_in) {
			spinner.style.display = 'none';
                throw new Error('Failed to generate wallet address');
            }

            const paymentAddress = walletData.address_in;

            // Generate QR code
            const qrResponse = await fetch(`https://api.paygate.to/crypto/${cryptoTicker}/qrcode.php?address=${paymentAddress}`);
            const qrData = await qrResponse.json();

            if (qrData.status !== 'success') {
			spinner.style.display = 'none';
                throw new Error('Failed to generate QR code');
            }

        // Hide spinner
        spinner.style.display = 'none';

            // Display result
            resultDiv.innerHTML = `
                <h2>Payment Details</h2>
                <p>Amount: ${amount} ${fiatCurrency}</p>
                <p>Crypto Amount: ${cryptoAmount} ${cryptoTicker}</p>
                <p>Payment Address: ${paymentAddress}</p>
            `;

            // Display QR code
            qrDiv.innerHTML = `<img src="data:image/png;base64,${qrData.qr_code}" alt="Payment QR Code">`;

        } catch (error) {
            console.error('Error:', error);
            document.getElementById('result').innerHTML = `<p>Error: ${error.message}</p>`;
        }
    });
    </script>
</body>
</html>
